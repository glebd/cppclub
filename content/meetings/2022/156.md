---
title: 156. WG21 October mailing, Contracts, fast math, Cpp2, C++ is deprecated
author: Gleb Dolgich
date: 2022-10-31
tags:
    - WG21
    - Mailing
    - Pattern matching
    - Profiling
    - GUI
    - GCC
    - Exceptions
    - Floating point
---

## WG21 October mailing (cont.)

[Mailing](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/#mailing2022-10) - 80 papers, 41 new!

[Reddit](https://www.reddit.com/r/cpp/comments/y60pec/wg21_aka_c_standard_committee_october_2022_mailing/)

### New papers

* **Follow-up** [C++ is the next C++](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2657r0.html)
    * [Reddit thread exploded a bit](https://www.reddit.com/r/programming/comments/yjyst3/c_is_the_next_c/) -- curiously, it looks like most commenters didn't actually read the paper but are responding to the catchy title. Says a lot about Reddit to be honest.
        * [Deep in the thread, an interesting comment about Carbon](https://www.reddit.com/r/programming/comments/yjyst3/c_is_the_next_c/iuqyr4x/)

* [P2632R0. A plan for better template meta programming facilities in C++26](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2632r0.pdf). Big plans. Separate proposals for each planned feature. Uses [Circle](https://www.circle-lang.org/) by [Sean Baxter](https://twitter.com/seanbax) as an implementation example.
    * [P2662R0. Pack indexing](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2662r0.pdf)
    * [P2671R0. Syntax Choices for Generalized Pack Declaration and Usage](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2671r0.html)
* [P2644R0. Get Fix of Broken Range-based for Loop Finally Done, by Nicolai Josuttis](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2644r0.pdf). A more general fix is not coming, it seems. But we have [P2012](http://wg21.link/P2012). Maybe it is good enough?
* [P2656R0. C++ Ecosystem International Standard](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2656r0.html). Interoperable tools, what a concept.
* [P2658R0. Temporary storage class specifiers](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2657r0.html). More dialects?
* [P2666R0. Last use optimization](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2666r0.pdf)
* [P2668R0. Role based parameter passing](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2668r0.pdf). Parameter attributes like in Cpp2, or automatic parameter handling like in Carbon.
    * [D0708. Parameter passing, by Herb Sutter](https://github.com/hsutter/708/blob/main/708.pdf)
* [P2670R0. Non-transient `constexpr` allocation, by Barry Revzin](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2670r0.html).
* [P2672R0. Exploring the Design Space for a Pipeline Operator, by Barry Revzin](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2672r0.html). The pipeline operator `|>` lives (maybe).
* [P2676R0. The Val Object Model](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2676r0.pdf). Food for thought for a future C++. (David Sankel is at Adobe now, huh.)
* [P2677R0. Reconsidering concepts in-place syntax](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2677r0.pdf). Bring back `auto{T}`!
* [P2688R0. Pattern Matching Discussion for Kona 2022](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2688r0.pdf). Can we have pattern matching in C++26, pretty please? Also, `match` is nicer than `inspect`, IMHO.

### Contracts!

* [P2659R0. A Proposal to Publish a Technical Specification for Contracts, by Brian Bi, Bloomberg](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2659r0.pdf).
* [P2660R0. Proposed Contracts TS](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2660r0.pdf). [P2661R0. Amendments](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2661r0.pdf). Uses attribute-based contract syntax.
* [P2680R0. Contracts for C++: Prioritizing Safety, by Gabriel Dos Reis](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2680r0.pdf)

## Fast math flag in libraries

Brendan Dolan-Gavitt wrote an article called [_Someone’s Been Messing With My Subnormals!_](https://moyix.blogspot.com/2022/09/someones-been-messing-with-my-subnormals.html), in which he describes an intrusive nature of the GCC/Clang compiler switch `-ffast-math`.

> TL;DR: After noticing an annoying warning, I went on an absurd yak shave, and discovered that because of a tiny handful of Python packages built with an appealing-sounding but dangerous compiler option, more than 2,500 Python packages—some with more than a million downloads per month—could end up causing any program that uses them to compute incorrect numerical results.

The discovery:

> It turns out (somewhat insanely) that when `-ffast-math` is enabled, the compiler will link in a constructor that sets the FTZ/DAZ flags whenever the library is loaded — even on shared libraries, which means that any application that loads that library will have its floating point behavior changed for the whole process. And `-Ofast`, which sounds appealingly like a "make my program go fast" flag, automatically enables `-ffast-math`, so some projects may unwittingly turn it on without realizing the implications.

Also, apparently, if you use `-Ofast`, `-fno-fast-math` does NOT disable the auto-enabled `-ffast-math`! WHAAAAT

The author wrote a Python script ([Gist](https://gist.github.com/moyix/2154125d0cb9947ec0525fb49449fab7)) to check if a library was compiled with `-ffast-math`.

Pretty crazy. Be careful with your math compiler options.

* [LLVM discussion of the bug](https://github.com/llvm/llvm-project/issues/57589)
* [GCC Bugzilla](https://gcc.gnu.org/bugzilla/show_bug.cgi?id=55522)

## CLion 2022.3 EAP: C++20 Modules Now Supported

* [CLion blog](https://blog.jetbrains.com/clion/2022/10/clion-2022-3-eap-cpp20-modules-now-supported/)
* [Reddit](https://www.reddit.com/r/cpp/comments/ybgy99/c20_modules_are_now_supported_in_clion/)

## CLion 2022.3 EAP: CMake Debugger

[CLion blog](https://blog.jetbrains.com/clion/2022/10/clion-2022-3-eap-cmake-debugger/)

Very cool.

## Cpp2 design notes

* [Herb Sutter](https://herbsutter.com/2022/10/04/cpp2-design-notes-ufcs-const-unsafe-and-yes-abi/)
    * [Cpp2 wiki](https://github.com/hsutter/cppfront/wiki)
* [Reddit](https://www.reddit.com/r/cpp/comments/xvyklg/cpp2_design_notes_ufcs_const_unsafe_and_yes_abi/)

## Mark Russinovich: C++ is deprecated

{{<tweet user="markrussinovich" id="1571995117233504257">}}

Mark is the CTO of Azure and the author of [Windows Sysinternals tools](https://learn.microsoft.com/en-us/sysinternals/).

Copying the tweet here in case he decides to delete it later:

> Speaking of languages, it's time to halt starting any new projects in C/C++ and use Rust for those scenarios where a non-GC language is required. For the sake of security and reliability. the industry should declare those languages as deprecated.

Me: _Laughs in C/C++_

* [Reddit](https://www.reddit.com/r/cpp/comments/xiuk3n/cto_of_azure_declares_c_deprecated/)

Liam Tung [disagrees](https://www-zdnet-com.cdn.ampproject.org/c/s/www.zdnet.com/google-amp/article/programming-languages-its-time-to-stop-using-c-and-c-for-new-projects-says-microsoft-azure-cto/)

The Register accidentally invokes [Betteridge's Law of Headlines](https://en.wikipedia.org/wiki/Betteridge%27s_law_of_headlines) with their article titled [_Is it time to retire C and C++ for Rust in new programs?_](https://www.theregister.com/2022/09/28/is_it_time_to_retire_c/)

* [Reddit](https://www.reddit.com/r/cpp/comments/xm82aw/microsoft_azure_cto_says_its_time_to_stop_using_c/)

## The pool of talented C++ developers is running dry

[Article](https://www.efinancialcareers.co.uk/news/2022/11/why-is-there-a-drought-in-the-talent-pool-for-c-developers)

A crypto trading firm can't find good developers, hmmm...

> Where are all the C++ programmers? People are seemingly scared away from the language by a terrible stigma: the notion that it is a legacy program. With big names in tech such as Microsoft Azure CEO Mark Russinovich calling people to “deprecate” C++ “for the sake of security and reliability,” in favour of Rust, this is hardly surprising.

That's certainly... a take.

The ending is encouraging:

> The reality is that there are plenty of C++ jobs available in finance, and that compared to other languages there are comparatively few people to fill them. The language may be hard. But it's also worth it.

[Reddit thread](https://www.reddit.com/r/cpp/comments/yk6leu/the_pool_of_talented_c_developers_is_running_dry/):

> I know I retired recently, but didn't expect it to have such an impact. But seriously, companies having trouble attracting people might want to look at what they are offering. Perhaps cheap and talented C++ developers are hard to find? [↑](https://www.reddit.com/r/cpp/comments/yk6leu/the_pool_of_talented_c_developers_is_running_dry/iurjida/)

In the thread there is a long [comment](https://www.reddit.com/r/cpp/comments/yk6leu/the_pool_of_talented_c_developers_is_running_dry/iuuczxa/) about interviewing practices at the company the article author works for, and oh boy. Maybe their problem lies elsewhere?

More in the same site: [C++ is the new Python](https://www.efinancialcareers.co.uk/news/2021/07/modern-c-finance-jobs) -- a weird title, but the article says that C++ is making a comeback. _Didn't know it was gone._

An amusing older article is titled [The world's top C++ programmer. And what he does at Morgan Stanley](https://www.efinancialcareers.co.uk/news/2020/12/bjarne-stroustrup-morgan-stanley). Calling Bjarne Stroustrup 'the top C++ programmer' is like calling Tim Berners-Lee 'the top web designer'.

## match(it)

A lightweight header-only pattern-matching library for C++17 with macro-free APIs.

* [GitHub](https://github.com/BowenFu/matchit.cpp)
* [match(it) vs. Pattern Matching proposal](https://github.com/BowenFu/matchit.cpp/blob/main/From-Pattern-Matching-Proposal-to-matchit.md)

## A General Overview of What Happens Before `main()`

[Embedded Artistry](https://embeddedartistry.com/blog/2019/04/08/a-general-overview-of-what-happens-before-main/)

See also: [CppCon 2018: Matt Godbolt “The Bits Between the Bits: How We Get to main()”](https://youtu.be/dOfucXtyEsU)

## Omnitrace: Application Profiling, Tracing, and Analysis

* [GitHub](https://github.com/AMDResearch/omnitrace)
* [Documentation](https://amdresearch.github.io/omnitrace/)
* [Reddit](https://www.reddit.com/r/cpp/comments/w8a0mg/omnitrace_new_performance_analysis_tool_for_cpus/)
* [YouTube](https://amdresearch.github.io/omnitrace/youtube.html)
* [Latest release 1.3.0](https://github.com/AMDResearch/omnitrace/releases/tag/v1.3.0)
* [Perfetto](https://perfetto.dev) System-wide profiling for Linux and Android by Google
    * [Perfetto build instructions](https://perfetto.dev/docs/contributing/build-instructions)
    * [Perfetto Web UI](https://ui.perfetto.dev)

> Omnitrace is a comprehensive profiling and tracing tool for parallel applications written in C, C++, Fortran, HIP, OpenCL, and Python which execute on the CPU or CPU+GPU. It is capable of gathering the performance information of functions through any combination of binary instrumentation, call-stack sampling, user-defined regions, and Python interpreter hooks. Omnitrace supports interactive visualization of comprehensive traces in the web browser in addition to high-level summary profiles with mean/min/max/stddev statistics. In addition to runtimes, Omnitrace supports the collection of system-level metrics such as the CPU frequency, GPU temperature, and GPU utilization, process-level metrics such as the memory usage, page-faults, and context-switches, and thread-level metrics such as memory usage, CPU time, and numerous hardware counters.

## Missing snappy C++ GUI applications

[Am I the only one miss C++ application GUI that is so much snappier and responsive than todays GUI framework such as Electron or others using python, JS etc?](https://www.reddit.com/r/cpp/comments/wakxsa/am_i_the_only_one_miss_c_application_gui_that_is/)

* Electron is very slow, inaccessible and looks like garbage on all operating systems.
* In 1992 applications were more responsive, see [Borland C++ 3.1](https://winworldpc.com/product/borland-c/30) and [Visual C++ 6.0](https://winworldpc.com/product/visual-c/6x).
* TUI is often faster than GUI.
* Qt applications are fast but look alien on all platforms.
* [WxWidgets](https://www.wxwidgets.org) uses native controls.

[Why Modern Computers Struggle to Match the Input Latency of an Apple IIe](https://www.extremetech.com/computing/261148-modern-computers-struggle-match-input-latency-apple-iie)

Electron is very energy-inefficient, which must contribute to global warming.

## GCC still doesn't support `std::format`

Reddit: [Does anyone know when gcc will support std::format?](https://www.reddit.com/r/cpp/comments/wb39so/does_anyone_know_when_gcc_will_support_stdformat/)

Use [{fmt}](https://fmt.dev) instead.

## Exceptions again

Reddit: [If exceptions were zero-cost from the very beginning, would you have designed your libraries / app differently?](https://www.reddit.com/r/cpp/comments/w7qsd8/if_exceptions_were_zerocost_from_the_very/)

The author thinks that if exceptions were truly zero-cost, they would be using exceptions everywhere, including function precondition checking, which is not ideal (see also C++ Contracts, which we don't have yet and probably never will).

In most cases, don't worry about the cost of exceptions. But don't throw thousands of exceptions in quick succession either.

Embedded platforms are a special case (no heap, or hard no-throw requirements).

Microsoft: [Modern C++ best practices for exceptions and error handling](https://docs.microsoft.com/en-us/cpp/cpp/errors-and-exception-handling-modern-cpp?view=msvc-170)

## Hdoc 1.3.0

* [Announcement](https://hdoc.io/blog/hdoc-1-3-0-release/)
* Reddit: [hdoc 1.3.0 is out, now with dark mode, template docs support, and easier navigation](https://www.reddit.com/r/cpp/comments/w83ckf/hdoc_130_is_out_now_with_dark_mode_template_docs/)

## Standard Library Modules Bug Bash

* [GitHub](https://github.com/StephanTLavavej/STL/wiki/Standard-Library-Modules-Bug-Bash)
* [Reddit](https://www.reddit.com/r/cpp/comments/w50v6i/standard_library_modules_bug_bash/)

## SwedenCpp Blog Roll

https://swedencpp.se/blogs

Thanks to Zdenek Wilczek for the link.

## Clang 15 released

* [LLVM forum announcement](https://discourse.llvm.org/t/llvm-15-0-0-release/65099)
* [Reddit](https://www.reddit.com/r/cpp/comments/x7bffy/clang_15_has_been_released/)

## argparse 2.9 released

* [GitHub](https://github.com/p-ranav/argparse)
* [Reddit](https://www.reddit.com/r/cpp/comments/xl05c1/argparse_v29_released_now_with_support_for/)

## Template errors are looooong

A redditor asks: [Why are template errors so horrendously verbose?](https://www.reddit.com/r/cpp/comments/xn09hn/why_are_template_errors_so_horrendously_verbose/)

Another [answers](https://www.reddit.com/r/cpp/comments/xn09hn/why_are_template_errors_so_horrendously_verbose/ipqw0vo/):

> They're not hard to read, they're tedious to read. The compiler is dumping the whole instantiation chain so you can find the information you need. How is it supposed to know which information you need? I'd rather have too much information than too little.

Lots of great answers in the thread.

## Force Inline in C++

[Megh Parikh](https://github.com/meghprkh/) wrote a universal [force-inline macro](https://meghprkh.github.io/blog/posts/c++-force-inline/). Redditors [discussed it](https://www.reddit.com/r/cpp/comments/x5b6qk/force_inline_in_c/) and explained why it's a misleading thing to do.

> ultimately, a sane compiler will optimize the code much better (on average) than you ever will hope the achieve by hand-optimization. [↑](https://www.reddit.com/r/cpp/comments/x5b6qk/force_inline_in_c/in0iuug/)

> Inlining is not about the function call overhead, it's about allowing more optimizations to happen at the call site [↑](https://www.reddit.com/r/cpp/comments/x5b6qk/force_inline_in_c/in13wcv/)

Note that the keyword `inline` has the sole purpose of preventing ODR violations and does not necessarily result in inlining. Not confusing at all.

## Improving Copy and Move Elision

* [Visual Studio Blog](https://devblogs.microsoft.com/cppblog/improving-copy-and-move-elision/)
* [Reddit](https://www.reddit.com/r/cpp/comments/ych8b5/improving_copy_and_move_elision/)

## Google Crubit

Crubit: C++/Rust Bidirectional Interop Tool

* [GitHub](https://github.com/google/crubit)
* [Design documentation](https://github.com/google/crubit/blob/main/docs/design.md)

## All Major C++17 Features You Should Know

* [B. Filipek](https://www.cppstories.com/2017/01/cpp17features/)
* [Reddit](https://www.reddit.com/r/cpp/comments/y195z3/all_major_c17_features_you_should_know/)

Each feature is annotated with supporting compiler versions.

## Regex shootout

* [GitHub](https://github.com/HFTrader/regex-performance)
* [Reddit](https://www.reddit.com/r/cpp/comments/y2kv53/regex_shootout_updated_hyperscan_1st_rust_2nd/)

Boost::Regex is passable, so is CTRE (expected somewhat better). `std::regex` is the slowest of all. [Intel Hyperscan](https://www.hyperscan.io/) is the fastest.

## Top 10 C++ conference talks 2019—2022

* [Polina Alekseeva, PVS-Studio blog](https://pvs-studio.com/en/blog/posts/cpp/0999/)
* [Reddit](https://www.reddit.com/r/cpp/comments/y71sx5/top_10_c_conference_talks_20192022)

## Stronk - a strong type and unit library

* [GitHub](https://github.com/twig-energy/stronk/)
* [Reddit](https://www.reddit.com/r/cpp/comments/x1jag3/stronk_an_easy_to_customize_strong_type_library/)

## Twitter: new tech vs. veteran

[DM of Engineering](https://twitter.com/dmofengineering/status/1556387621047132160):

New to tech:
This will totally work.

Tech veteran:
There's no way that works.

[DM of Engineering](https://twitter.com/dmofengineering/status/1556389086725672960):

New to tech:
I’m proud that my code worked on the first try.

Tech Veteran:
I’m suspicious because my code worked on the first try.

[DM of Engineering](https://twitter.com/dmofengineering/status/1556388408078938112):

New to tech:
This code has been running for 2 years, we should rewrite it.

Tech Veteran:
This code has been running for 20 years, I’m starting to feel like maybe we’ve got the bugs out.

[DM of Engineering](https://twitter.com/dmofengineering/status/1556384811467489281):

New to tech:
I am a magician. I create things from pure thought.

Tech Veteran:
I am a plumber.
