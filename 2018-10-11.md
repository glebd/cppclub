---
title:    C++ Club Meeting Notes
author:   Gleb Dolgich
date:     2018-10-11
---

# JetBrains C++ team at CppCon 2018: trip report

[Post by Anastasia Kazakova and Phil Nash](https://blog.jetbrains.com/clion/2018/10/jb-cpp-at-cppcon-2018/)

# Deterministic Disappointment, by Niall Douglas (1/4)

* [Video](https://youtu.be/cbUTAoHy6Ls)
    - Example of a poorly-designed file system API
    - Illustration of how expensive it is to allocate memory
    - History of C++ exceptions
    - Throwing/catching is approximately 300 times slower than other error handling mechanisms
    - Many code bases ban exceptions (high maintenance costs, allocation needed, unpredictable)
    - Explanation of C++ `<system_error>` and how it is used wrong everywhere
        + [P1028: SG14 `status_code` and standard error object](http://wg21.link/p1028) is better
* [Slides](https://docs.google.com/presentation/d/1fSkpD51FKmy8VEO9P86jWN6tOEaBmzHOXo14zLRkFKE/edit#slide=id.p)
* [Niall's proposal N2289/P1095](http://www.open-std.org/jtc1/sc22/wg14/www/docs/n2289.pdf)
* [Herb Sutter's proposal P0709](http://wg21.link/p0709)

# Deterministic Disappointment, by Niall Douglas (2/4)

## Let's add exceptions to C (and Rust/Go/Python etc.)!

* If a C function is marked with `fails(E)` its calling convention changes to return `union` of return type `T` and error type `E`.
* Discriminant is lightweight and architecture-specific (for example, CPU carry flag)
* Fails-functions must be explicitly called with `catch(...)` or `try(...)`
* `fails_errno` is a boilerplate expansion and solves the global `errno` problem

# Deterministic Disappointment, by Niall Douglas (3/4)

## C++

* Functions can be marked with:
    - `throws`
    - `throws(E)`
    - `fails(E)`
    - `noexcept`
    - nothing

# Deterministic Disappointment, by Niall Douglas (4/4)

* One possible implementation of [P0709](http://wg21.link/p0709)
* Solves a few long-standing problems in C and POSIX
* Enables C code to call C++ code without exception translation wrappers (also Rust, Go, Python etc.)
* C++ can send/get exceptions to/from C

# IT Hare posts on std::error exceptions

* [1: The Good](http://ithare.com/app-level-developer-on-std-error-exceptions-proposal-for-c-part-i-the-good/)
    - "While existing C++ exceptions DO have (about)-zero runtime CPU cost when the exception is not fired, it comes at the cost of the path-when-the-exception-IS-fired being huge, and worse – being next-to-impossible to predict in advance."
    - "With existing exception model, we cannot see which functions are allowed to throw. This leads us to the situation where we need either to (a) think that everything out there can throw (leading to very inefficient use of our brains to make everything out there exception-safe), or (b) forget about exception safety entirely (which actually happens way too often in real-world projects)."
    - "No single error handling method is good enough for ALL the projects – which in turn leads to creation of C++ dialects, with some of the projects using exceptions, and some others using error codes."

# IT Hare posts on std::error exceptions

* [2: The Discussion](http://ithare.com/app-level-developer-on-stderror-exceptions-proposal-for-c-part-ii-the-discussion/)
* [3: Unchecked exceptions for C++](http://ithare.com/unchecked-exceptions-for-c/)
    - "There EXIST real-world cases when failing hard is NOT a good option" (Ariane 5)
    - "Fail-Fast-AND-Soft"
    - "Unchecked exceptions MAY be thrown out of nothrow functions without causing trouble" _(Hmmm...)_
    - "“unchecked” std::errors are treated as “something which should never ever happen, but in practice MAY occur as a result of potentially-recoverable bug”"

# Concepts TS vs. C++20 Concepts

[Reddit](https://www.reddit.com/r/cpp/comments/9m8xg2/concepts_ts_vs_c20_concepts/)

> Why is the short-form of concept constraints isn't included in C++20?

# Pointer-to-member-functions can be tricky

* [Post](http://www.elbeno.com/blog/?p=1575)
* [Snippet](https://godbolt.org/z/-juwda)
* [Raymond Chen: Pointers to member functions are very strange animals](https://blogs.msdn.microsoft.com/oldnewthing/20040209-00/?p=40713)

# Prepare thy Pitchforks: A De-facto Standard Project Layout

* [Early Reddit post](https://www.reddit.com/r/cpp/comments/996q8o/prepare_thy_pitchforks_a_de_facto_standard/)
* [Later Reddit post](https://www.reddit.com/r/cpp/comments/9eq46c/pitchforks_part_ii_project_layout_and_naming/)
* [Blog post](https://vector-of-bool.github.io/2018/09/16/layout-survey.html)
* [GitHub repo](https://github.com/vector-of-bool/pitchfork/blob/spec/data/spec.bs)

# Exploring C++ types with `puts(__PRETTY_FUNCTION__)`

* [Post](https://quuxplusone.github.io/blog/2018/08/22/puts-pretty-function/)
    - [Reddit](https://www.reddit.com/r/cpp/comments/99huzd/exploring_c_types_with_puts_pretty_function/)
    - [boost::core::typeinfo](https://www.boost.org/doc/libs/1_68_0/libs/core/doc/html/core/typeinfo.html)

```cpp
template<class T>
void f() {
    puts(__PRETTY_FUNCTION__); // __FUNCSIG__ in MSVC
}

#define EXPLORE(expr) \
    printf("decltype(" #expr ") is... "); \
    f<decltype(expr)>();
```

# Mutexes are passé

* [Post](http://stryku.pl/poetry/mutexes_are_passe.php)
    - [Reddit](https://www.reddit.com/r/cpp/comments/9dysnl/mutexes_are_pass%C3%A9/)

# Reimplementing NumPy in C++

* [NumCpp](https://github.com/dpilger26/NumCpp)
* [xtensor](https://xtensor.readthedocs.io/en/latest/numpy.html)

## Other linear algebra libraries

* [Blaze](https://bitbucket.org/blaze-lib/blaze)
* [Eigen](https://github.com/eigenteam/eigen-git-mirror)
    * [the official repo](https://bitbucket.org/eigen/eigen)
    * [docs](http://eigen.tuxfamily.org/index.php?title=Main_Page)

# Reboot Your Dreamliner Every 248 Days To Avoid Integer Overflow

* [Article](https://www.i-programmer.info/news/149-security/8548-reboot-your-dreamliner-every-248-days-to-avoid-integer-overflow.html)
    * [Reddit](https://www.reddit.com/r/programming/comments/9ctbvm/reboot_your_dreamliner_every_248_days_to_avoid/)

> This condition is caused by a software counter internal to the Generator Control Units (GCUs) that will overflow after 248 days of continuous power. We are issuing this <directive> to prevent loss of all AC electrical power, which could result in loss of control of the airplane.

# Visual C++ Team Blog - std::any: How, when, and why

[Post](https://blogs.msdn.microsoft.com/vcblog/2018/10/04/stdany-how-when-and-why/)

> When you need to store an object of an arbitrary type, pull std::any out of your toolbox. Be aware that there are probably more appropriate tools available when you do know something about the type to be stored.

# C++ Best Practices, by Jason Turner

[GitHub](https://github.com/lefticus/cppbestpractices/blob/master/00-Table_of_Contents.md)

# Library: SQLite ORM

* [Code](https://github.com/fnc12/sqlite_orm)
    - Licence: BSD-2-Clause
    - C++14

# Library: Inja - a template engine for modern C++

* [Code](https://github.com/pantor/inja)
    - Licence: MIT
    - Header-only
    - Uses NLohmann's [JSON library](https://github.com/nlohmann/json/releases)
    - [Conan wrapper](https://github.com/DEGoodmanWilson/conan-inja)

```cpp
json data;
data["name"] = "world";
inja::render("Hello {{ name }}!", data); // Returns "Hello world!"
```

# Library: C++ REST SDK (formerly Casablanca) by Microsoft

* [Code](https://github.com/Microsoft/cpprestsdk)
    - Licence: MIT
    - C++11
    - Supports Windows, Linux, macOS, iOS, Android

> The C++ REST SDK is a Microsoft project for cloud-based client-server communication in native code using a modern asynchronous C++ API design. This project aims to help C++ developers connect to and interact with services.

# Library: Caffe2 - A New Lightweight, Modular, and Scalable Deep Learning Framework

* [Website](https://caffe2.ai/)
* [Code](https://github.com/caffe2/caffe2)
    - Licence: Apache-2.0

# Tool: Superluminal profiler for Windows

[Website](https://www.superluminal.eu/)

* Combines sampling and instrumentation
* Visualizes thread communication flow
* Kernel-level callstacks
* Dynamic filtering of areas of interest
* High frequency sampling (8 KHz)
* Timeline view, call graph, source view
* 7-day free trial, then EUR 99/149/289

# Conan, vcpkg or build2?

[Reddit](https://www.reddit.com/r/cpp/comments/9m4l0p/conan_vcpkg_or_build2/)

* Pragmatic choice: vcpkg or Conan (they work today and are complete enough)
* Pragmatic no-brainer choice: vcpkg (it's the simplest and it have more packages ready)
* Pragmatic but need finer control choice: Conan (it gives more options)
* (Very) Long term choice: Build2 (shows great promises because it uses a coherent model...)
* Ideal choice (from the future): help SG15 (the group reflecting on tools vs C++) define interfaces for build systems and dependency managers so that your choice is not impacted by your dependencies choices.

# Improving C++ Builds with Split DWARF

[Article](http://www.productive-cpp.com/improving-cpp-builds-with-split-dwarf/)

```bash
$ g++ -c -g -gsplit-dwarf main.cpp -o main.o
$ g++ main.o -o app
```

# Having some fun with higher-order functions

* [Article by Barry Revzin](https://medium.com/@barryrevzin/having-some-fun-with-higher-order-functions-e3e30ec69969)
* [Boost.HOF](https://www.boost.org/doc/libs/1_68_0/libs/hof/doc/html/doc/index.html#)

# Twitter

![](img/book-use-auto_ptr.png)

# Twitter

![](img/sleep30.png)

# Twitter

![](img/todd.png)
