---
title:    C++ Club Meeting Notes
author:   Gleb Dolgich
date:     2018-03-08
---

# Visual Studio 2017 version 15.6 released

* [Release notes](https://docs.microsoft.com/en-us/visualstudio/releasenotes/vs2017-relnotes)
* [C++ improvements](https://docs.microsoft.com/en-us/visualstudio/releasenotes/vs2017-relnotes#CPlusPlus)

# Chrome switches to Clang on Windows, ditches MSVC

* [Ars Technica](https://arstechnica.com/gadgets/2018/03/chrome-on-windows-ditches-microsofts-compiler-now-uses-clang/)
* [LLVM Blog](http://blog.llvm.org/2018/03/clang-is-now-used-to-build-chrome-for.html)

> Building Chrome locally with Clang is about 15% slower than with MSVC.

# Accio Dependency Manager, by Corentin

* [Post](https://medium.com/@corentin.jabot/accio-dependency-manager-b1846e1caf76)

See also:

* [Guy Davidson: Batteries not included: what should go in the C++ standard library?](https://hatcat.com/?p=16)
* [Corentin: A cake for your cherry: what should go in the C++ standard library?](https://hackernoon.com/a-cake-for-your-cherry-what-should-go-in-the-c-standard-library-804fcecccef8)
* [Titus Winters: What Should Go Into the C++ Standard Library](https://abseil.io/blog/20180227-what-should-go-stdlib)

# C++: Thoughts on Dealing with Signed/Unsigned Mismatch

* [IT Hare](http://ithare.com/c-thoughts-on-dealing-with-signedunsigned-mismatch/)
* [Reddit](https://www.reddit.com/r/cpp/comments/82hmsc/c_thoughts_on_dealing_with_signedunsigned_mismatch/)
* [Previously on Reddit](https://www.reddit.com/r/cpp/comments/7y0o6r/is_it_a_good_practice_to_use_unsigned_values/)

> Matters discussed here are related to mitigation of certain decisions which were made 50+ years ago and which are pretty much carved in stone now.

> Developers, while trying to get rid exactly of signed/unsigned warning, turned a perfectly-working-program-with-warnings, into a program-without-warnings-but-which-fails-once-a-day-or-so.

# Stealth features responsible for half of F-35 defects

* [Defence News (2018)](https://www.defensenews.com/air/2018/03/06/stealth-features-responsible-for-half-of-f-35-defects-lockheed-program-head-states/)
* [JSF C++ Coding Standard (2005)](http://www.stroustrup.com/JSF-AV-rules.pdf)
* [HackerNews (1)](https://news.ycombinator.com/item?id=3967316), [HackerNews (2)](https://news.ycombinator.com/item?id=7628746)
* [F-35 Joint Strike Fighter benefits from modern software testing, quality assurance (2013)](http://www.militaryaerospace.com/articles/2013/10/software-code-f-35.html)
* [F-35 Software Reliability](https://www.reuters.com/article/us-usa-lockheed-fighter/exclusive-pentagon-report-faults-f-35-on-software-reliability-idUSBREA0M1L920140123), [Reddit](https://www.reddit.com/r/programming/comments/1vypm3/f35_software_reliability/)

> <...> so-called quality escapes — errors made by Lockheed’s workforce that could include drilling holes that are too big or installing a dinged part

# C++ Metaprogramming

* [Reddit question](https://www.reddit.com/r/cpp/comments/82nbdv/c_metaprogramming/)
* Book: [C++ Templates: The Complete Guide, 2nd ed, by Vandervoorde, Josuttis, Gregor](https://www.amazon.com/C-Templates-Complete-Guide-2nd/dp/0321714121)
* Video: [Introduction to C++ Template Metaprogramming - Sasha Goldshtein](https://www.youtube.com/watch?v=lrziylOWBT4)
* Video: CppCon 2014: Walter E. Brown "Modern Template Metaprogramming: A Compendium [Part 1](https://www.youtube.com/watch?v=Am2is2QCvxY), [Part 2](https://www.youtube.com/watch?v=a0FliKwcwXE&t=1s)
* Video: CppCon 2016: Arthur O'Dwyer “Template Normal Programming [Part 1](https://www.youtube.com/watch?v=vwrXHznaYLA), [Part 2](https://www.youtube.com/watch?v=VIz6xBvwYd8)

> The main "rule" when doing template metaprogramming is, "if the value yield by such an expression is non-sensical, this function / class / etc... is skipped"

# C++ Metaprogramming (cont.)

C++:

```cpp
template <
    typename T
  , std::enable_if_t<
      std::negation_v<
        std::conjunction<
            std::is_arithmetic<T>::type
          , std::is_same<T, QStringList>::type
        >
      >
    >* = nullptr>
QDataStream& operator>>(QDataStream& stream, T& obj);
```

# C++ Metaprogramming (cont.)

Lisp:

```lisp
(enable_if
   (not
    (and
     (is_arithmetic T)
     (is_same T QStringList)
    )
   )
  )
```

# Non-virtual destructors

* [Post](https://blog.knatten.org/2018/03/02/non-virtual-destructors/)

```cpp
struct B {
  B() { std::cout << 'b'; }
  ~B() { std::cout << 'B'; }
};
struct D : B {
  D() { std::cout << 'd'; }
  ~D() { std::cout << 'D'; }
};
int main() {
  B* p = new D;
  delete p;
}
```

* [Herb Sutter's GotW #5](https://herbsutter.com/2013/05/22/gotw-5-solution-overriding-virtual-functions/) -- "base’s destructor should be virtual or protected."

# `shared_ptr` reference count for `nullptr`

[StackOverflow](https://stackoverflow.com/questions/48885252/c-sharedptr-use-count-for-nullptr)

```cpp
shared_ptr<int> sptr2(nullptr);
cout << "sptr2 use_count: " << sptr2.use_count() << endl;

shared_ptr<int> sptr6(nullptr, default_delete<int>());
cout << "sptr6 use_count: " << sptr6.use_count() << endl;
```

Output:

```
sptr2 use_count: 0
sptr6 use_count: 1
```

# Arno Schödl - A Practical Approach to Error Handling

* [YouTube](https://www.youtube.com/watch?v=tTz_JRJJrsc)
* [think-cell](https://www.think-cell.com/en/)
* The main product plugs into PowerPoint to provide chart auto-layout
* Patches PowerPoint code at run time (client-server architecture)
* They disassemble PowerPoint and related libraries using [IDA](https://www.hex-rays.com/products/ida/) to find entry points (working against undocumented APIs)!

# Arno Schödl - A Practical Approach to Error Handling (cont.)

* Strong exception guarantee is very hard to achieve in application code: too many state changes
* What to do on error:
    * Collect information, send report home
    * Stop further reporting, as program state is undefined
    * Despite the above, carry on and never terminate!
    * Server stops processing certain type of requests if too many threads hang
    * Reproduce error in the lab, handle reproducible errors only
* Asserts can be wrong! Don't terminate on assert, call home instead, otherwise developers will be afraid to add asserts!
* Reporting server gets 1 crash report per second on average

# Smf RPC

*smf* is a new RPC system and code generation like gRPC, Cap'n'Proto, Apache Thrift, etc, but designed for microsecond tail latency.

* [Home page](https://senior7515.github.io/smf/)
* [Code](https://github.com/senior7515/smf)
* [Reddit](https://www.reddit.com/r/cpp/comments/807rgh/show_reditcpp_smf_cpp_community_feedback/)

Based on [Seastar](http://www.seastar-project.org/) ([code](https://github.com/scylladb/seastar)) by [ScyllaDB](https://www.scylladb.com/).

# Frozen: a header-only, constexpr alternative to gperf for C++14 users

Header-only library that provides zero-cost initialization for immutable containers and various algorithms.

* [Code](https://github.com/serge-sans-paille/frozen) (Apache 2.0)
* [Intro](https://blog.quarkslab.com/frozen-an-header-only-constexpr-alternative-to-gperf-for-c14-users.html)

```cpp
#include <frozen/unordered_set.h>

constexpr frozen::unordered_set<int, 3> keys = {1,2,4};

int some_user(int key) {
    return keys.count(key);
}
```

# Video: The hidden rules of world-class C++ code - Boris Schäling - Meeting C++ 2017

[Video](https://www.youtube.com/watch?v=fu6N6JbPOrI)

How we know if a code base is good or bad?

# Video: Free your functions! - Klaus Iglberger - Meeting C++ 2017

[Video](https://www.youtube.com/watch?v=nWJHhtmWYcY)

Data should be as encapsulated as possible => free functions lead to better encapsulation than member functions.

How to test a private function?

* `friend` test function (bad)
* `#define private public` (worse)
* free function operating on data in the class (better)

# Fun with (user-defined) attributes - Jonathan Müller - Meeting C++ 2017

* [Video](https://www.youtube.com/watch?v=Pt6oeIpzue4)

Syntax:

* Simple identifiers: `[[foo]]`
* Pack expansion: `[[foo...]]`
* Multiple attributes: `[[foo, bar, baz]]`
* Arguments: `[[foo(a, "b", 3.14, +)]]`
* Namespaces: `[[foo::bar]]`
* Using declaration: `[[using foo: bar, baz]]`

# Fun with (user-defined) attributes - Jonathan Müller - Meeting C++ 2017 (cont.)

```cpp
[[noreturn]] void handle_error(std::string msg)
{
    throw std::runtime_error(std::move(msg));
}
```

# Fun with (user-defined) attributes - Jonathan Müller - Meeting C++ 2017 (cont.)

```cpp
alignas(128) char cacheline[128];
```

# Fun with (user-defined) attributes - Jonathan Müller - Meeting C++ 2017 (cont.)

```cpp
void func(int param);

[[deprecated("pass a parameter instead")]]
void func()
{
    func(0);
}
```

# Fun with (user-defined) attributes - Jonathan Müller - Meeting C++ 2017 (cont.)

```cpp
switch (selected_option)
{
    <...>
    case option::b:
        if (foo)
            log_error("option::b may not be used when foo is set");
        // otherwise b is exactly like c so continue on
        [[fallthrough]];
    case option::c:
        <...>
}
```

# Fun with (user-defined) attributes - Jonathan Müller - Meeting C++ 2017 (cont.)

```cpp
[[nodiscard]]
int error();
```

# Fun with (user-defined) attributes - Jonathan Müller - Meeting C++ 2017 (cont.)

```cpp
[[maybe_unused]]
static bool is_valid(int param);

void do_something(int a, [[maybe_unused]] int b)
{
    <...>
}
```

# Fun with (user-defined) attributes - Jonathan Müller - Meeting C++ 2017 (cont.)

Compiler-specific attributes change generated code, C++ standard ones don't.

# CppCon 2017: Andrew Sutton “Meta”

* [YouTube](https://www.youtube.com/watch?v=29IqPeKL_QY)

# Video: Secure Programming Practices in C++ - NDC Security 2018

[YouTube](https://www.youtube.com/watch?v=Jh0G_A7iRac)

# Video: C++ Performance and Optimisation - NDC Techtown 2017

[YouTube](https://www.youtube.com/watch?v=eICYHA-eyXM)

# Video: Concurrent Programming in C++ - NDC Techtown 2017

[YouTube](https://www.youtube.com/watch?v=O7gUNNYjmsM)

# Video: True parallelism, with no concept of threads - Alfred Bratterud - Meeting C++ 2017

[YouTube](https://www.youtube.com/watch?v=9IXivbSA_5A)

# Video: Deep Learning with C++ - Peter Goldsborough - Meeting C++ 2017

[YouTube](https://www.youtube.com/watch?v=8GoYXWOq55A)

# Video: CppCon 2016: "C++14 Reflections Without Macros, Markup nor External Tooling"

[YouTube](https://www.youtube.com/watch?v=abdeAew3gmQ)

# Variadic CRTP, by Steve Dewhurst

[PDF](http://stevedewhurst.com/once_weakly/once-weakly20170328/once-weakly20170328.pdf)

# Twitter

Stephan T. Lavavej:

> Unintentional Zen-like saying in the C++17 Standard: "If the path is empty, stop."