<!-- page_number: true -->
<!-- $size: 16:9 -->

# C++ Club

## 3 August 2017

---

# Toronto trip report by Andrew Pardoe (MSFT)

[Post](https://blogs.msdn.microsoft.com/vcblog/2017/07/28/trip-report-evolution-working-group-at-the-summer-iso-c-standards-meeting-toronto/)

* Biggest news: [Concepts TS](https://wg21.link/p0734) merged into [C++ draft standard](https://wg21.link/n4659)
	* EWG is committed to bringing back an abbreviated syntax in future meetings, ideally before C++20 is finished. [P0694R0](https://wg21.link/P0694) is a paper by Bjarne Stroustrup on the natural syntax.
* [Modules TS](https://wg21.link/n4610) discussions in detail
* Other proposals described in detail
* Discouraged proposals

---

# Precompiled Header (PCH) issues and recommendations

[Andrew Pardoe et al., Microsoft](https://blogs.msdn.microsoft.com/vcblog/2017/07/13/precompiled-header-pch-issues-and-recommendations/)

* Move to a newer compiler, use x64 compiler
* Multi-CPU systems: Failure to automatically increase the pagefile size (Windows bug)
* Pass `/p:PreferredToolArchtecture=x64` to MSBuild
* Use `/MP` compiler option ([Details](https://docs.microsoft.com/en-us/cpp/build/reference/mp-build-with-multiple-processes))
* Don't use `#pragma hdrstop`, use `/Fp<PCH-file-name>` instead

---

# cppcoro - a library of coroutine abstractions

> The 'cppcoro' library provides a set of general-purpose primitives for making use of the coroutines TS proposal described in N4628.

[GitHub](https://github.com/lewissbaker/cppcoro)

* Coroutine types: `task<T>`, `lazy_task<T>`, `shared_task<T>`, `shared_lazy_task<T>`, `generator<T>`, `recursive_generator<T>`, `async_generator<T>`
* Awaitable types: `single_consumer_event`, `async_mutex`, `async_manual_reset_event`, `async_auto_reset_event`
* Cancellation: `cancellation_token`, `cancellation_source`, `cancellation_registration`
* Schedulers and I/O: `io_service`, `io_work_scope`, `file`, `readable_file`, `writable_file`, `read_only_file`, `write_only_file`, `read_write_file`

---

# Your own error code

[Post](https://akrzemi1.wordpress.com/2017/07/12/your-own-error-code/)

* _System error support in C++0x_ by Chris Kohlhoff: [Part 1](http://blog.think-async.com/2010/04/system-error-support-in-c0x-part-1.html), [Part 2](http://blog.think-async.com/2010/04/system-error-support-in-c0x-part-2.html), [Part 3](http://blog.think-async.com/2010/04/system-error-support-in-c0x-part-3.html), [Part 4](http://blog.think-async.com/2010/04/system-error-support-in-c0x-part-4.html), [Part 5](http://blog.think-async.com/2010/04/system-error-support-in-c0x-part-5.html)
* `std::error_code`

---

# DIMWITS: DIMensional analysis With unITS

[GitHub](https://github.com/njoy/dimensionalanalysis) -- C++14, Copyright (c) 2016, Los Alamos National Security, LLC

```cpp
/* quantities play nicely with auto */
auto myVelocity = 1.0 * meter / second;
std::cout << "The speed is: " << myVelocity << std::endl;

/* quantities of the same dimensionality can be implicitly converted */
Quantity<Foot> myLength = 1.0 * meter;
std::cout << "1 meter in feet is: " << myLength << std::endl;

/* si-prefixes can be specified on either side of the assignment */
Quantity<Kilo<Gram>> myMass = 1.0 * mega(tonne);
std::cout << "1 megatonne in kilograms is: " << myMass << std::endl;

/* NIST values for common physical constants are provided */
std::cout << "The speed of light is: " << constant::lightSpeed << std::endl;
```

---

# sltbench -- a C++ micro-benchmarking tool

[GitHub](https://github.com/ivafanas/sltbench) -- Apache 2.0 licence

* 4.7x times faster than googlebench

```cpp
void my_function()
{
	std::vector<size_t> v(100000, 0);
	std::sort(v.begin(), v.end());
}

SLTBENCH_FUNCTION(my_function);

SLTBENCH_MAIN();
```

---

# spdlog -- an ultra-fast C++ logging library

[GitHub](https://github.com/gabime/spdlog) -- C++11, MIT licence

* header-only
* Linux, FreeBSD, Solaris, Mac OS, Windows, Android
* Uses {fmt} library for formatting
* Async mode using lock-free queues
* Custom formatting
* Conditional logging
* Targets: rotating/daily log files, console (w/colour), syslog, Windows debugger
* Severity-based filtering

---

# The long-arrow operator in C++

[By Ivan Čukić](http://cukic.co/2017/07/12/the-long-arrow-operator-in-cxx/)

```cpp
template <typename T>
class wrap {
public:
    T* operator->()    { return &t; }
    T& operator--(int) {  return t; }

private:
    T t;
};

wrap<wrap<std::string>> wp1;
wp1--->length();

wrap<wrap<wrap<std::string>>> wp2;
wp2----->length();
```

